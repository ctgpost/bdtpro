import{r as a,j as e,Q as E,s as R,F as P,L as $,W as M,v as K,aY as F,x as H,q as W}from"./chunk-DgDPklex.js";import{B as N,C as k,g as Q,h as J,i as Y,c as q}from"./chunk-DDg_V9Pg.js";import{a as U}from"./chunk-DVULmWha.js";import{m as h}from"./chunk-CbcvW3Ig.js";function V({country:n,index:b}){const l=n.totalTickets>0?n.availableTickets/n.totalTickets*100:0,i=l>50?"high":l>20?"medium":"low";return e.jsx(h.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:b*.1,duration:.5},whileHover:{scale:1.02,y:-5},whileTap:{scale:.98},children:e.jsx($,{to:`/tickets/${n.code.toLowerCase()}`,children:e.jsxs(k,{className:"h-full luxury-card hover:shadow-2xl transition-all duration-300 cursor-pointer group border-0 overflow-hidden relative",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-luxury-gold/5 to-luxury-bronze/5 opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),e.jsx("div",{className:`absolute top-2 right-2 w-3 h-3 rounded-full z-20 ${i==="high"?"bg-green-500 animate-pulse":i==="medium"?"bg-yellow-500":"bg-red-500"}`,title:`${l.toFixed(0)}% available`}),e.jsxs(Q,{className:"text-center responsive-padding pb-2 relative z-10",children:[e.jsx("div",{className:"text-4xl mb-2 group-hover:scale-110 transition-transform",children:n.flag}),e.jsx(J,{className:"font-heading responsive-text velvet-text group-hover:text-primary transition-colors",children:n.name}),e.jsx(Y,{className:"font-body text-sm text-foreground/60",children:n.code})]}),e.jsxs(q,{className:"space-y-4 relative z-10 responsive-padding",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-body text-sm text-foreground/70",children:"Available"}),e.jsx("span",{className:"font-heading font-semibold text-primary",children:n.availableTickets.toLocaleString()})]}),e.jsx("div",{className:"w-full bg-gradient-to-r from-cream-200 to-cream-300 rounded-full h-3 overflow-hidden",children:e.jsx("div",{className:`h-3 rounded-full transition-all duration-500 ${i==="high"?"bg-gradient-to-r from-green-400 to-green-600 animate-glow":i==="medium"?"bg-gradient-to-r from-yellow-400 to-orange-500":"bg-gradient-to-r from-red-400 to-red-600"}`,style:{width:`${Math.max(l,2)}%`,transition:"width 0.5s ease-in-out"}})}),e.jsxs("div",{className:"flex justify-between items-center text-xs font-body text-foreground/50",children:[e.jsxs("span",{children:["Total: ",n.totalTickets.toLocaleString()]}),e.jsxs("span",{children:[l.toFixed(0),"% available"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-3 pt-2 border-t border-border/30",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"p-1 bg-gradient-to-br from-blue-100 to-blue-200 rounded animate-float",children:e.jsx(H,{className:"h-3 w-3 text-blue-600"})}),e.jsx("span",{className:"font-body text-xs mobile-text-sm text-foreground/70",children:"Multiple Airlines"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`p-1 rounded animate-float ${i==="high"?"bg-gradient-to-br from-green-100 to-green-200":i==="medium"?"bg-gradient-to-br from-yellow-100 to-yellow-200":"bg-gradient-to-br from-red-100 to-red-200"}`,style:{animationDelay:"0.5s"},children:e.jsx(W,{className:`h-3 w-3 ${i==="high"?"text-green-600":i==="medium"?"text-yellow-600":"text-red-600"}`})}),e.jsx("span",{className:"font-body text-xs mobile-text-sm text-foreground/70",children:i==="high"?"High Availability":i==="medium"?"Limited Stock":"Low Stock"})]})]})]})]})})})}function te(){const[n,b]=a.useState([]),[l,w]=a.useState(!0),[i,j]=a.useState(null),[o,T]=a.useState(null),[x,D]=a.useState(navigator.onLine),[c,z]=a.useState(!0),[C,I]=a.useState(!1),m=a.useRef(null),p=a.useRef(!0),d=a.useCallback(async(s=!0)=>{try{s?w(!0):I(!0),j(null),console.log("🌍 Loading countries data...");const t=localStorage.getItem("bd_ticket_pro_token");console.log("🔑 Auth token present:",!!t);const r=await U.getCountries();if(console.log("✅ Countries API response:",r),console.log("📊 Countries array:",r.countries),p.current){const g=(r.countries||[]).map(f=>({...f,totalTickets:Number(f.totalTickets)||0,availableTickets:Number(f.availableTickets)||0}));b(g),T(new Date),j(null),console.log("✅ Countries data loaded successfully:",g);const u=r.totals?.total||g.reduce((f,S)=>f+S.totalTickets,0),O=r.totals?.available||g.reduce((f,S)=>f+S.availableTickets,0);console.log(`📈 Summary: ${u} total tickets, ${O} available across ${g.length} countries`),console.log("📊 API provided totals:",r.totals)}}catch(t){console.error("�� Failed to load countries:",t);const r=t instanceof Error?t.message:"Unknown error";if(console.log("🔍 Error details:",{message:r,isAuthError:r.includes("401")||r.includes("Unauthorized")||r.includes("authentication"),hasToken:!!localStorage.getItem("bd_ticket_pro_token")}),!localStorage.getItem("bd_ticket_pro_token")&&(r.includes("401")||r.includes("Unauthorized"))){console.log("🔐 Attempting auto-login...");try{const u=await U.login({username:"admin",password:"admin123"});return console.log("✅ Auto-login successful:",u),await d(s)}catch(u){console.log("❌ Auto-login failed:",u)}}if(r.includes("401")||r.includes("Unauthorized")||r.includes("authentication")){console.log("🔑 Using demo data due to authentication...");const u=[{code:"KSA",name:"Saudi Arabia",flag:"🇸🇦",totalTickets:55,availableTickets:48},{code:"UAE",name:"United Arab Emirates",flag:"🇦🇪",totalTickets:55,availableTickets:52},{code:"QAT",name:"Qatar",flag:"🇶🇦",totalTickets:25,availableTickets:22},{code:"KWT",name:"Kuwait",flag:"🇰🇼",totalTickets:18,availableTickets:16},{code:"OMN",name:"Oman",flag:"🇴🇲",totalTickets:22,availableTickets:19},{code:"BHR",name:"Bahrain",flag:"🇧����",totalTickets:16,availableTickets:14},{code:"JOR",name:"Jordan",flag:"🇯🇴",totalTickets:20,availableTickets:17},{code:"LBN",name:"Lebanon",flag:"🇱🇧",totalTickets:14,availableTickets:11}];p.current&&(b(u),T(new Date),j(null),console.log("✅ Demo countries loaded:",u))}else p.current&&(j(r),b([]))}finally{p.current&&(s?w(!1):I(!1))}},[]);a.useEffect(()=>{const s=()=>{D(!0),c&&d(!1)},t=()=>D(!1);return window.addEventListener("online",s),window.addEventListener("offline",t),()=>{window.removeEventListener("online",s),window.removeEventListener("offline",t)}},[d,c]),a.useEffect(()=>(c&&x?m.current=setInterval(()=>{d(!1)},3e4):m.current&&(clearInterval(m.current),m.current=null),()=>{m.current&&clearInterval(m.current)}),[c,x,d]),a.useEffect(()=>()=>{p.current=!1,m.current&&clearInterval(m.current)},[]),a.useEffect(()=>{d()},[d]);const y=a.useCallback(()=>{d(!0)},[d]),A=a.useCallback(()=>{z(s=>!s)},[]),_=a.useCallback(()=>{if(!o)return"";const t=Math.floor((new Date().getTime()-o.getTime())/1e3);return t<60?`Updated ${t}s ago`:t<3600?`Updated ${Math.floor(t/60)}m ago`:o.toLocaleTimeString()},[o]);if(a.useEffect(()=>{const s=setInterval(()=>{T(t=>t)},1e3);return()=>clearInterval(s)},[]),a.useEffect(()=>{const s=t=>{if(!(t.ctrlKey||t.metaKey))switch(t.key.toLowerCase()){case"r":t.preventDefault(),y();break;case"t":t.preventDefault(),A();break}};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[y,A]),l)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(E,{className:"h-6 w-6 animate-spin text-primary"}),e.jsx("span",{className:"font-body text-foreground",children:"Loading countries..."})]})});const L=n.reduce((s,t)=>s+t.availableTickets,0),v=n.reduce((s,t)=>s+t.totalTickets,0),B=v>0;return i?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(R,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-heading font-bold text-foreground mb-2",children:"Error Loading Countries"}),e.jsx("p",{className:"text-foreground/70 font-body mb-4",children:i}),e.jsxs(N,{onClick:y,className:"velvet-button text-primary-foreground font-body",disabled:l,children:[e.jsx(E,{className:`h-4 w-4 mr-2 ${l?"animate-spin":""}`}),"Retry"]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(h.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.5},children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-4 min-w-0 flex-1",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-luxury-gold to-luxury-bronze rounded-full animate-glow animate-float",children:e.jsx(P,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"responsive-heading font-heading font-bold velvet-text",children:"Countries"}),e.jsx("p",{className:"text-foreground/70 font-body",children:"Browse tickets by destination country"}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:e.jsx($,{to:"/tickets",children:e.jsx("div",{className:"px-3 py-1 bg-green-100 border border-green-300 rounded-md inline-block hover:bg-green-200 transition-colors cursor-pointer",children:e.jsxs("span",{className:"text-sm font-medium text-green-800",children:["Total: ",v," | Available: ",L," → View All Tickets"]})})})})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 sm:space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 order-2 sm:order-1",children:[e.jsxs("div",{className:"flex items-center space-x-1 text-xs",children:[x?e.jsx(M,{className:"h-3 w-3 text-green-500"}):e.jsx(K,{className:"h-3 w-3 text-red-500"}),e.jsx("span",{className:`font-body ${x?"text-green-600":"text-red-600"}`,children:x?"Online":"Offline"})]}),e.jsxs(N,{onClick:A,variant:c?"default":"outline",size:"sm",className:"font-body text-xs px-2 py-1 touch-target",title:c?"Disable auto-refresh":"Enable auto-refresh",children:[e.jsx(F,{className:"h-3 w-3 mr-1"}),"Auto"]}),e.jsxs(N,{onClick:y,variant:"outline",size:"sm",disabled:l,className:"font-body hover:scale-105 transform transition-all duration-200 touch-target",children:[e.jsx(E,{className:`h-4 w-4 mr-2 ${l?"animate-spin":""}`}),"Refresh"]}),e.jsx(N,{onClick:async()=>{console.log("🔍 Debug: Current countries data:",n),console.log("🔍 Debug: Last updated:",o),console.log("🔍 Debug: Loading state:",l),console.log("🔍 Debug: Error state:",i);try{const t=await(await fetch("/api/tickets/debug/counts",{headers:{Authorization:`Bearer ${localStorage.getItem("bd_ticket_pro_token")}`}})).json();console.log("🔍 Debug API Response:",t),t.success&&alert(`Debug Info:
Countries Stats Total: ${t.data.fromStats.total}
Direct Tickets Total: ${t.data.fromTickets.total}
Discrepancy: ${t.data.discrepancy.total}

Available from Stats: ${t.data.fromStats.available}
Available from Tickets: ${t.data.fromTickets.available}
Available Discrepancy: ${t.data.discrepancy.available}`)}catch(s){console.error("Debug API failed:",s)}},variant:"outline",size:"sm",className:"font-body text-xs touch-target",children:"Debug"})]}),e.jsxs("div",{className:"hidden lg:flex items-center space-x-6 luxury-card p-4 rounded-lg border-0 backdrop-blur-md order-1 sm:order-2",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-heading font-bold text-primary velvet-text",children:L.toLocaleString()}),e.jsx("p",{className:"text-xs font-body text-foreground/60",children:"Available"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-heading font-bold text-foreground velvet-text",children:v.toLocaleString()}),e.jsx("p",{className:"text-xs font-body text-foreground/60",children:"Total"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-heading font-bold text-blue-600 velvet-text",children:n.length}),e.jsx("p",{className:"text-xs font-body text-foreground/60",children:"Countries"})]}),o&&e.jsxs("div",{className:"text-center border-l border-border/30 pl-4",children:[e.jsx("p",{className:"text-xs font-body text-foreground/60",children:_()}),c&&x&&e.jsxs("div",{className:"flex items-center justify-center mt-1",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${C?"bg-blue-500 animate-spin":"bg-green-500 animate-pulse"}`}),e.jsx("span",{className:`text-xs font-body ml-1 ${C?"text-blue-600":"text-green-600"}`,children:C?"Updating...":"Live"})]})]})]})]})]})}),e.jsxs(h.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2,duration:.5},className:"md:hidden grid grid-cols-3 gap-4",children:[e.jsxs(k,{className:"text-center p-4 luxury-card border-0",children:[e.jsx("div",{className:"text-xl font-heading font-bold text-primary velvet-text",children:L.toLocaleString()}),e.jsx("div",{className:"text-xs font-body text-foreground/60",children:"Available"})]}),e.jsxs(k,{className:"text-center p-4 luxury-card border-0",children:[e.jsx("div",{className:"text-xl font-heading font-bold text-foreground velvet-text",children:v.toLocaleString()}),e.jsx("div",{className:"text-xs font-body text-foreground/60",children:"Total"})]}),e.jsxs(k,{className:"text-center p-4 luxury-card border-0",children:[e.jsx("div",{className:"text-xl font-heading font-bold text-blue-600 velvet-text",children:n.length}),e.jsx("div",{className:"text-xs font-body text-foreground/60",children:"Countries"}),o&&c&&x&&e.jsxs("div",{className:"flex items-center justify-center mt-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-xs font-body text-green-600 ml-1",children:"Live"})]})]})]}),B&&e.jsx(h.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4,duration:.5},className:"luxury-card p-4 border-l-4 border-blue-500 bg-blue-50/50",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(R,{className:"h-5 w-5 text-blue-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-heading font-semibold text-blue-900 mb-1",children:"Ticket Count Information"}),e.jsxs("p",{className:"text-sm text-blue-800 mb-2",children:["This page shows summary statistics by country. The"," ",e.jsx($,{to:"/tickets",className:"underline hover:text-blue-900",children:"All Tickets page"})," ","shows individual ticket records with pagination limits."]}),e.jsxs("p",{className:"text-xs text-blue-700",children:["Countries Total: ",v," tickets | Click any country card to see detailed tickets for that destination."]})]})]})}),n.length>0?e.jsx("div",{className:"responsive-grid gap-4 sm:gap-6",children:n.map((s,t)=>e.jsx(V,{country:s,index:t},s.code))}):e.jsxs(h.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.4,duration:.5},className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"🎯"}),e.jsx("h3",{className:"text-xl font-heading font-bold text-green-600 mb-2",children:"Database is Clean & Ready!"}),e.jsx("p",{className:"text-foreground/70 font-body mb-4",children:"All demo ticket data has been removed. You can now start adding real tickets."}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 max-w-md mx-auto",children:[e.jsx("h4",{className:"font-semibold text-green-800 mb-2",children:"Next Steps:"}),e.jsxs("ul",{className:"text-sm text-green-700 space-y-1 text-left",children:[e.jsx("li",{children:"• Add ticket batches through Admin → Buy Tickets"}),e.jsx("li",{children:"• Create real bookings through the booking system"}),e.jsx("li",{children:"• Start managing real customer data"}),e.jsx("li",{children:"• Countries will appear here once tickets are added"})]})]})]}),e.jsx(h.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.8,duration:.5},className:"text-center py-8",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"font-body text-sm text-foreground/50",children:"Click on any country to view available tickets and make bookings"}),o&&e.jsxs("p",{className:"font-body text-xs text-foreground/40",children:["Last updated: ",o.toLocaleString()," •",c&&x?"Auto-refreshing every 30s":"Manual refresh only"]}),e.jsx("p",{className:"font-body text-xs text-foreground/30",children:"Press 'R' to refresh • Press 'T' to toggle auto-refresh"})]})})]})}export{te as C};
