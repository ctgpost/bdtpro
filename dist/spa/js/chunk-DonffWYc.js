import{r as d,j as e,s as V,Q as z,q as F,b5 as te,b1 as se,b2 as ae,x as le,F as re,aX as ne,aY as ie,p as M,bd as oe,aW as de,H as ce}from"./chunk-DgDPklex.js";import{u as xe,a as me,E as T,C as f,c as g,B as w,g as he,h as ue,i as fe,I as ge,S as $,j as R,k as E,l as I,m as x,N as be,b as p}from"./chunk-DDg_V9Pg.js";import{a as q}from"./chunk-DVULmWha.js";import{m as N}from"./chunk-CbcvW3Ig.js";function je({ticket:s,index:b,showBuyingPrice:o,onView:S,onBook:m}){const _=(l,h)=>{if(h===0)return e.jsx(p,{variant:"outline",className:"bg-red-50 text-red-700 border-red-200",children:"No Seats"});switch(l){case"available":return e.jsx(p,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:"Available"});case"booked":return e.jsx(p,{variant:"outline",className:"bg-blue-50 text-blue-700 border-blue-200",children:"Booked"});case"locked":return e.jsx(p,{variant:"outline",className:"bg-yellow-50 text-yellow-700 border-yellow-200",children:"Locked"});case"sold":return e.jsx(p,{variant:"outline",className:"bg-gray-50 text-gray-700 border-gray-200",children:"Sold"});default:return e.jsx(p,{variant:"outline",children:"Unknown"})}},c=s.status==="sold"||s.available_seats===0,C=s.status==="available"&&s.available_seats>0;return e.jsxs(N.tr,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:b*.05,duration:.3},className:`border-b border-border/20 hover:bg-gradient-to-r hover:from-cream-100/50 hover:to-transparent transition-all duration-300 ${c?"opacity-60":""}`,children:[e.jsx("td",{className:"px-4 py-3 font-body text-sm text-foreground",children:b+1}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(le,{className:"h-4 w-4 text-foreground/40"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-body font-medium text-sm text-foreground",children:s.batch?.airline||s.airline_name||s.airline||"Airline not set"}),e.jsx("div",{className:"font-body text-xs text-foreground/50",children:s.batch?.flight_number||s.flight_number||s.flight_code||"Flight number not set"})]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(re,{className:"h-4 w-4 text-foreground/40"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-body font-medium text-sm text-foreground",children:(()=>{const l=s.batch?.origin||s.origin||"Dhaka",h=s.batch?.destination||s.destination||s.country?.name||"Destination";return`${l} → ${h}`})()}),e.jsxs("div",{className:"font-body text-xs text-foreground/50 flex items-center",children:[s.country?.flag&&e.jsx("span",{className:"mr-1",children:s.country.flag}),s.country?.name||"Country not set"]})]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ne,{className:"h-4 w-4 text-foreground/40"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-body font-medium text-sm text-foreground",children:(()=>{const l=s.batch?.flight_date||s.flight_date||s.departure_date;if(l)try{return new Date(l).toLocaleDateString()}catch{return console.warn("Invalid date format:",l),l}return"Date not set"})()}),e.jsx("div",{className:"font-body text-xs text-foreground/50",children:(()=>{const l=s.batch?.flight_date||s.flight_date||s.departure_date;if(l)try{return new Date(l).toLocaleDateString("en-US",{weekday:"long"})}catch{return"Invalid date"}return"No date"})()})]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ie,{className:"h-4 w-4 text-foreground/40"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-body text-sm text-foreground",children:s.batch?.departure_time||s.flight_time||s.departure_time||"Time not set"}),(()=>{const l=s.batch?.arrival_time||s.arrival_time;return l?e.jsxs("div",{className:"font-body text-xs text-foreground/50",children:["Arr: ",l]}):null})()]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(M,{className:"h-4 w-4 text-green-600"}),e.jsxs("span",{className:"font-body font-semibold text-sm text-green-600",children:["৳",s.selling_price.toLocaleString()]})]})}),o&&e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(M,{className:"h-4 w-4 text-red-600"}),e.jsxs("span",{className:"font-body font-semibold text-sm text-red-600",children:["৳",s.buying_price?.toLocaleString()||"N/A"]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(oe,{className:"h-4 w-4 text-foreground/40"}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-body font-medium text-sm text-foreground",children:[s.available_seats," / ",s.total_seats]}),e.jsx("div",{className:"font-body text-xs text-foreground/50",children:"Available"})]})]})}),e.jsx("td",{className:"px-4 py-3",children:_(s.status,s.available_seats)}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(w,{size:"sm",variant:"outline",onClick:()=>S(s),className:"font-body text-xs hover:scale-105 transform transition-all duration-200",children:[e.jsx(de,{className:"h-3 w-3 mr-1"}),"View"]}),C&&e.jsxs(w,{size:"sm",onClick:()=>m(s),className:"font-body text-xs velvet-button text-primary-foreground hover:scale-105 transform transition-all duration-200",children:[e.jsx(ce,{className:"h-3 w-3 mr-1"}),"Book"]}),c&&e.jsx(p,{variant:"outline",className:"bg-red-50 text-red-700 border-red-200 text-xs",children:s.available_seats===0?"NO SEATS":"SOLD OUT"})]})})]})}function Se(){const{hasPermission:s}=xe(),{toast:b}=me(),[o,S]=d.useState(""),[m,_]=d.useState("all"),[c,C]=d.useState("all"),[l,h]=d.useState("all"),[j,L]=d.useState([]),[H,O]=d.useState(!0),[P,U]=d.useState(null),[Q,A]=d.useState(null),[W,B]=d.useState(!1),D=s("view_buying_price"),y=async(t=!0)=>{try{t&&O(!0),U(null);const a=await q.getAllTickets({limit:1e3});if(console.log("🎫 Raw ticket data:",a),console.log(`📊 Loaded ${a.length} tickets`),Array.isArray(a)){a.length>0&&(console.log("Sample ticket structure:",a[0]),console.log("Sample ticket batch:",a[0].batch),console.log("Available date fields:",{batch_flight_date:a[0].batch?.flight_date,flight_date:a[0].flight_date,departure_date:a[0].departure_date,batch_departure_time:a[0].batch?.departure_time,flight_time:a[0].flight_time,departure_time:a[0].departure_time}));const r=a.map(i=>({...i,selling_price:i.selling_price||0,available_seats:i.available_seats||0,total_seats:i.total_seats||1,status:i.status||"available",country:i.country||{code:"N/A",name:"Unknown",flag:"🏳️"}}));L(r)}else console.warn("Invalid ticket data received:",a),L([])}catch(a){console.error("Failed to load tickets:",a),U("Failed to load tickets"),L([])}finally{O(!1)}};d.useEffect(()=>{y()},[]);const X=j.filter(t=>t.country).map(t=>({code:t.country.code,name:t.country.name,flag:t.country.flag})).filter((t,a,r)=>a===r.findIndex(i=>i.code===t.code)),Y=j.map(t=>t.batch?.airline||t.airline_name||t.airline).filter((t,a,r)=>t&&r.indexOf(t)===a).filter(Boolean),u=j.filter(t=>{const a=t.batch?.airline||t.airline_name||t.airline||"",r=t.country?.name||"",i=t.batch?.flight_number||t.flight_number||"",n=!o||a.toLowerCase().includes(o.toLowerCase())||r.toLowerCase().includes(o.toLowerCase())||i.toLowerCase().includes(o.toLowerCase()),k=m==="all"||t.status===m,ee=c==="all"||t.country?.code===c;return n&&k&&ee&&(l==="all"||a===l)}),v={total:u.length,available:u.filter(t=>t.status==="available"&&t.available_seats>0).length,booked:u.filter(t=>t.status==="booked").length,locked:u.filter(t=>t.status==="locked").length,sold:u.filter(t=>t.status==="sold"||t.available_seats===0).length},G=t=>{A(t);const a=t.batch?.airline||t.airline_name||t.airline||"Unknown Airline",r=t.batch?.flight_number||t.flight_number||"";b({title:"Ticket Details",description:`Viewing ${a} ${r?`(${r})`:""} details`})},J=t=>{A(t),B(!0)},K=async t=>{try{const a=await q.createBooking(t);b({title:"Booking Created Successfully! 🎉",description:`Booking ID: ${a.bookingId} | Passenger: ${t.passengerInfo.name}`}),await y(!1),B(!1),A(null)}catch(a){console.error("Booking submission failed:",a);let r="Failed to create booking. Please try again.";a.message&&(a.message.includes("not available")?r="This ticket is no longer available. Please select another ticket.":a.message.includes("validation")?r="Please check all required fields and try again.":r=a.message),b({title:"Booking Failed",description:r,variant:"destructive"}),r.includes("not available")&&await y(!1)}},Z=()=>{const t=[["SL","Airline","Route","Date","Time","Price","Seats","Status"].join(","),...u.map((n,k)=>[k+1,n.batch?.airline||n.airline||"N/A",`${n.batch?.origin||"Origin"} → ${n.batch?.destination||n.country?.name||"Destination"}`,n.batch?.flight_date?new Date(n.batch.flight_date).toLocaleDateString():n.departure_date||"N/A",n.batch?.departure_time||n.departure_time||"N/A",`৳${n.selling_price.toLocaleString()}`,`${n.available_seats}/${n.total_seats}`,n.status].join(","))].join(`
`),a=new Blob([t],{type:"text/csv"}),r=window.URL.createObjectURL(a),i=document.createElement("a");i.href=r,i.download=`tickets-export-${new Date().toISOString().split("T")[0]}.csv`,i.click(),window.URL.revokeObjectURL(r),b({title:"Export Complete",description:"Tickets data exported to CSV file"})};return H?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(T,{className:"h-12 w-12 rounded-full"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{className:"h-8 w-48"}),e.jsx(T,{className:"h-4 w-64"})]})]}),e.jsx(f,{children:e.jsx(g,{className:"p-6",children:e.jsx("div",{className:"space-y-4",children:[...Array(5)].map((t,a)=>e.jsx(T,{className:"h-16 w-full"},a))})})})]}):P?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(V,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-heading font-bold text-foreground mb-2",children:"Error Loading Tickets"}),e.jsx("p",{className:"text-foreground/70 font-body mb-4",children:P}),e.jsxs(w,{onClick:()=>y(),className:"velvet-button text-primary-foreground font-body",children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Retry"]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(N.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.5},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-luxury-gold to-luxury-bronze rounded-full animate-glow animate-float",children:e.jsx(F,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-heading font-bold velvet-text",children:"All Tickets"}),e.jsx("p",{className:"text-foreground/70 font-body",children:"Manage and book flight tickets from all destinations"}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-2",children:[e.jsxs("div",{className:"px-3 py-1 bg-gray-100 rounded-full inline-flex items-center space-x-2",children:[e.jsx(F,{className:"h-4 w-4 text-gray-600"}),e.jsxs("span",{className:"text-sm font-medium text-gray-800",children:["Showing ",j.length," tickets"," ",j.length>=1e3?"(reached limit)":"(all tickets)"]})]}),j.length>=1e3&&e.jsxs("div",{className:"px-3 py-1 bg-orange-100 rounded-full inline-flex items-center space-x-2",children:[e.jsx(V,{className:"h-4 w-4 text-orange-600"}),e.jsx("span",{className:"text-sm font-medium text-orange-800",children:"More tickets may exist - contact admin to see all"})]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(w,{onClick:Z,variant:"outline",size:"sm",className:"font-body hover:scale-105 transform transition-all duration-200",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Export"]}),e.jsxs(w,{onClick:()=>y(),variant:"outline",size:"sm",className:"font-body hover:scale-105 transform transition-all duration-200",children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Refresh"]})]})]})}),e.jsx(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2,duration:.5},children:e.jsxs(f,{className:"luxury-card border-0",children:[e.jsxs(he,{children:[e.jsxs(ue,{className:"font-heading flex items-center space-x-2 velvet-text",children:[e.jsx(se,{className:"h-5 w-5"}),e.jsx("span",{children:"Filters & Search"})]}),e.jsx(fe,{className:"font-body",children:"Search and filter tickets by various criteria"})]}),e.jsx(g,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ae,{className:"absolute left-3 top-3 h-4 w-4 text-foreground/40"}),e.jsx(ge,{placeholder:"Search airline, country, flight...",value:o,onChange:t=>S(t.target.value),className:"pl-10 font-body"})]}),e.jsxs($,{value:m,onValueChange:_,children:[e.jsx(R,{className:"font-body",children:e.jsx(E,{placeholder:"Filter by status"})}),e.jsxs(I,{children:[e.jsx(x,{value:"all",children:"All Status"}),e.jsx(x,{value:"available",children:"Available"}),e.jsx(x,{value:"booked",children:"Booked"}),e.jsx(x,{value:"locked",children:"Locked"}),e.jsx(x,{value:"sold",children:"Sold"})]})]}),e.jsxs($,{value:c,onValueChange:C,children:[e.jsx(R,{className:"font-body",children:e.jsx(E,{placeholder:"Filter by country"})}),e.jsxs(I,{children:[e.jsx(x,{value:"all",children:"All Countries"}),X.map(t=>e.jsxs(x,{value:t.code,children:[t.flag," ",t.name]},t.code))]})]}),e.jsxs($,{value:l,onValueChange:h,children:[e.jsx(R,{className:"font-body",children:e.jsx(E,{placeholder:"Filter by airline"})}),e.jsxs(I,{children:[e.jsx(x,{value:"all",children:"All Airlines"}),Y.map(t=>e.jsx(x,{value:t,children:t},t))]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("span",{className:"font-body text-sm text-foreground/70",children:[v.total," tickets found"]})})]})})]})}),e.jsxs(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3,duration:.5},className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsx(f,{className:"text-center luxury-card border-0",children:e.jsxs(g,{className:"p-4",children:[e.jsx("div",{className:"text-2xl font-heading font-bold text-foreground velvet-text",children:v.total}),e.jsxs("div",{className:"text-sm font-body text-foreground/60",children:["Total",j.length>=200&&e.jsx("div",{className:"text-xs text-orange-600 mt-1",children:"(May be limited)"})]})]})}),e.jsx(f,{className:"text-center luxury-card border-0",children:e.jsxs(g,{className:"p-4",children:[e.jsx("div",{className:"text-2xl font-heading font-bold text-green-600 velvet-text",children:v.available}),e.jsx("div",{className:"text-sm font-body text-foreground/60",children:"Available"})]})}),e.jsx(f,{className:"text-center luxury-card border-0",children:e.jsxs(g,{className:"p-4",children:[e.jsx("div",{className:"text-2xl font-heading font-bold text-blue-600 velvet-text",children:v.booked}),e.jsx("div",{className:"text-sm font-body text-foreground/60",children:"Booked"})]})}),e.jsx(f,{className:"text-center luxury-card border-0",children:e.jsxs(g,{className:"p-4",children:[e.jsx("div",{className:"text-2xl font-heading font-bold text-yellow-600 velvet-text",children:v.locked}),e.jsx("div",{className:"text-sm font-body text-foreground/60",children:"Locked"})]})}),e.jsx(f,{className:"text-center luxury-card border-0",children:e.jsxs(g,{className:"p-4",children:[e.jsx("div",{className:"text-2xl font-heading font-bold text-foreground/60 velvet-text",children:v.sold}),e.jsx("div",{className:"text-sm font-body text-foreground/60",children:"Sold"})]})})]}),e.jsx(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4,duration:.5},children:e.jsx(f,{className:"luxury-card border-0",children:e.jsx(g,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto scrollbar-thin scrollbar-track-transparent scrollbar-thumb-border/20",children:e.jsxs("table",{className:"w-full min-w-[800px]",children:[e.jsx("thead",{className:"bg-gradient-to-r from-cream-100 to-cream-200 border-b border-border/30",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left font-heading font-semibold text-sm text-foreground velvet-text",children:"SL"}),e.jsx("th",{className:"px-4 py-3 text-left font-heading font-semibold text-sm text-foreground velvet-text",children:"Airline"}),e.jsx("th",{className:"px-4 py-3 text-left font-heading font-semibold text-sm text-foreground velvet-text",children:"Route"}),e.jsx("th",{className:"px-4 py-3 text-left font-heading font-semibold text-sm text-foreground velvet-text",children:"Departure Date"}),e.jsx("th",{className:"px-4 py-3 text-left font-heading font-semibold text-sm text-foreground velvet-text",children:"Time"}),e.jsx("th",{className:"px-4 py-3 text-left font-heading font-semibold text-sm text-foreground velvet-text",children:"Selling Price"}),D&&e.jsx("th",{className:"px-4 py-3 text-left font-heading font-semibold text-sm text-foreground velvet-text",children:"Buying Price"}),e.jsx("th",{className:"px-4 py-3 text-left font-heading font-semibold text-sm text-foreground velvet-text",children:"Seats"}),e.jsx("th",{className:"px-4 py-3 text-left font-heading font-semibold text-sm text-foreground velvet-text",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left font-heading font-semibold text-sm text-foreground velvet-text",children:"Action"})]})}),e.jsx("tbody",{children:u.length>0?u.map((t,a)=>e.jsx(je,{ticket:t,index:a,showBuyingPrice:D,onView:G,onBook:J},t.id||`ticket-${a}`)):e.jsx("tr",{children:e.jsx("td",{colSpan:D?10:9,className:"px-4 py-12 text-center",children:e.jsxs("div",{className:"flex flex-col items-center space-y-3",children:[e.jsx(F,{className:"h-12 w-12 text-foreground/30"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-heading font-medium text-green-600 mb-1",children:o||m!=="all"||c!=="all"||l!=="all"?"No tickets match your criteria":"Database is Clean & Ready for Real Data!"}),e.jsx("p",{className:"font-body text-sm text-foreground/60",children:o||m!=="all"||c!=="all"||l!=="all"?"Try adjusting your filters or search terms":"All demo tickets have been removed. Add real tickets through Admin → Buy Tickets"}),(o||m!=="all"||c!=="all"||l!=="all")&&e.jsx("button",{onClick:()=>{S(""),_("all"),C("all"),h("all")},className:"mt-2 text-primary hover:underline text-sm font-medium",children:"Clear all filters"})]})]})})})})]})})})})}),e.jsx(be,{isOpen:W,onClose:()=>{B(!1),A(null)},ticket:Q,onSubmit:K})]})}export{Se as T};
