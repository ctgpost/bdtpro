import{r as m,j as e,s as _,J as B,Q as q,b0 as u,p as L,q as Y,aU as J,bh as Q,bf as K,G as M,bd as E,b5 as W,a_ as X,bi as Z,bg as ee,aY as se}from"./chunk-DgDPklex.js";import{u as ae,a as te,C as r,c as l,E as x,L as $,I as F,B as w,T as ne,d as re,e as f,f as b,g as h,h as g,i as j,b as R,p as z,q as U,r as y,s as o,t as O,v as i}from"./chunk-DDg_V9Pg.js";import{a as k}from"./chunk-DVULmWha.js";import{m as d}from"./chunk-CbcvW3Ig.js";function me(){const{user:le,hasPermission:I}=ae(),{toast:T}=te(),[a,V]=m.useState(null),[G,C]=m.useState(!0),[N,S]=m.useState({startDate:new Date(Date.now()-720*60*60*1e3).toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0]}),[c,H]=m.useState("overview");m.useEffect(()=>{P()},[N]);const P=async()=>{C(!0);try{const s=await k.getDashboardStats(),t=await k.getBookings({limit:100}),A=await k.getCountries(),p={salesReport:{totalRevenue:s.todaysSales?.amount||0,totalBookings:s.totalBookings||0,avgTicketPrice:s.todaysSales?.amount&&s.todaysSales?.count?Math.round(s.todaysSales.amount/s.todaysSales.count):0,profitMargin:0,dailySales:[]},countryReport:{topCountries:[]},agentReport:{topAgents:[]},paymentReport:{paymentMethods:[],pendingPayments:0,completedPayments:0}};V(p)}catch(s){console.error("Failed to load report data:",s),T({title:"Error Loading Reports",description:"Failed to load report data. Please try again.",variant:"destructive"})}finally{C(!1)}},D=s=>{if(!a)return;let t="";c==="countries"?t=[["Country","Bookings","Revenue","Average Price","Market Share"].join(","),...a.countryReport.topCountries.map(n=>[n.country,n.bookings,n.revenue,Math.round(n.revenue/n.bookings),`${(n.bookings/a.salesReport.totalBookings*100).toFixed(1)}%`].join(","))].join(`
`):c==="agents"?t=[["Agent","Bookings","Revenue","Average Deal Size"].join(","),...a.agentReport.topAgents.map(n=>[n.agent,n.bookings,n.revenue,Math.round(n.revenue/n.bookings)].join(","))].join(`
`):t=[["Metric","Value"].join(","),["Total Revenue",`à§³${a.salesReport.totalRevenue.toLocaleString()}`],["Total Bookings",a.salesReport.totalBookings],["Average Ticket Price",`à§³${a.salesReport.avgTicketPrice.toLocaleString()}`],["Profit Margin",`${a.salesReport.profitMargin}%`]].join(`
`);const A=new Blob([t],{type:"text/csv"}),p=window.URL.createObjectURL(A),v=document.createElement("a");v.href=p,v.download=`${c}-report-${new Date().toISOString().split("T")[0]}.csv`,v.click(),window.URL.revokeObjectURL(p),T({title:"Export Complete",description:`${c} report exported as ${s.toUpperCase()}`})};return I("view_profit")?G?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(x,{className:"h-12 w-12 rounded-full"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{className:"h-8 w-48"}),e.jsx(x,{className:"h-4 w-64"})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[...Array(4)].map((s,t)=>e.jsx(r,{className:"luxury-card border-0",children:e.jsx(l,{className:"p-6",children:e.jsx(x,{className:"h-20 w-full"})})},t))}),e.jsx(r,{className:"luxury-card border-0",children:e.jsx(l,{className:"p-6",children:e.jsx(x,{className:"h-64 w-full"})})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(d.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.5},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-luxury-gold to-luxury-bronze rounded-full animate-glow animate-float",children:e.jsx(B,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-heading font-bold velvet-text",children:"Business Reports"}),e.jsx("p",{className:"text-foreground/70 font-body",children:"Comprehensive analytics and business insights"})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{htmlFor:"startDate",className:"font-body text-sm",children:"From:"}),e.jsx(F,{id:"startDate",type:"date",value:N.startDate,onChange:s=>S(t=>({...t,startDate:s.target.value})),className:"w-auto font-body"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{htmlFor:"endDate",className:"font-body text-sm",children:"To:"}),e.jsx(F,{id:"endDate",type:"date",value:N.endDate,onChange:s=>S(t=>({...t,endDate:s.target.value})),className:"w-auto font-body"})]}),e.jsxs(w,{onClick:P,variant:"outline",size:"sm",className:"font-body hover:scale-105 transform transition-all duration-200",children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"Refresh"]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(d.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1,duration:.5},children:e.jsx(r,{className:"luxury-card border-0 hover:shadow-xl transition-all duration-300",children:e.jsx(l,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-foreground/70 font-body",children:"Total Revenue"}),e.jsxs("p",{className:"text-2xl font-heading font-bold velvet-text",children:["à§³",a?.salesReport.totalRevenue.toLocaleString()]}),e.jsxs("p",{className:"text-sm text-green-600 flex items-center mt-1 font-body",children:[e.jsx(u,{className:"h-4 w-4 mr-1"}),"+12.5% from last month"]})]}),e.jsx("div",{className:"p-3 bg-gradient-to-br from-green-100 to-green-200 rounded-full",children:e.jsx(L,{className:"h-8 w-8 text-green-600"})})]})})})}),e.jsx(d.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2,duration:.5},children:e.jsx(r,{className:"luxury-card border-0 hover:shadow-xl transition-all duration-300",children:e.jsx(l,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-foreground/70 font-body",children:"Total Bookings"}),e.jsx("p",{className:"text-2xl font-heading font-bold velvet-text",children:a?.salesReport.totalBookings}),e.jsxs("p",{className:"text-sm text-blue-600 flex items-center mt-1 font-body",children:[e.jsx(u,{className:"h-4 w-4 mr-1"}),"+8.3% from last month"]})]}),e.jsx("div",{className:"p-3 bg-gradient-to-br from-blue-100 to-blue-200 rounded-full",children:e.jsx(Y,{className:"h-8 w-8 text-blue-600"})})]})})})}),e.jsx(d.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3,duration:.5},children:e.jsx(r,{className:"luxury-card border-0 hover:shadow-xl transition-all duration-300",children:e.jsx(l,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-foreground/70 font-body",children:"Avg. Ticket Price"}),e.jsxs("p",{className:"text-2xl font-heading font-bold velvet-text",children:["à§³",a?.salesReport.avgTicketPrice.toLocaleString()]}),e.jsxs("p",{className:"text-sm text-purple-600 flex items-center mt-1 font-body",children:[e.jsx(u,{className:"h-4 w-4 mr-1"}),"+3.7% from last month"]})]}),e.jsx("div",{className:"p-3 bg-gradient-to-br from-purple-100 to-purple-200 rounded-full",children:e.jsx(J,{className:"h-8 w-8 text-purple-600"})})]})})})}),e.jsx(d.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4,duration:.5},children:e.jsx(r,{className:"luxury-card border-0 hover:shadow-xl transition-all duration-300",children:e.jsx(l,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-foreground/70 font-body",children:"Profit Margin"}),e.jsxs("p",{className:"text-2xl font-heading font-bold velvet-text",children:[a?.salesReport.profitMargin,"%"]}),e.jsxs("p",{className:"text-sm text-orange-600 flex items-center mt-1 font-body",children:[e.jsx(u,{className:"h-4 w-4 mr-1"}),"+1.2% from last month"]})]}),e.jsx("div",{className:"p-3 bg-gradient-to-br from-orange-100 to-orange-200 rounded-full",children:e.jsx(Q,{className:"h-8 w-8 text-orange-600"})})]})})})})]}),e.jsx(d.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5,duration:.5},children:e.jsxs(ne,{value:c,onValueChange:H,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(re,{className:"luxury-card border-0",children:[e.jsxs(f,{value:"overview",className:"font-body",children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"Overview"]}),e.jsxs(f,{value:"countries",className:"font-body",children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Countries"]}),e.jsxs(f,{value:"agents",className:"font-body",children:[e.jsx(E,{className:"h-4 w-4 mr-2"}),"Agents"]}),e.jsxs(f,{value:"payments",className:"font-body",children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Payments"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(w,{variant:"outline",size:"sm",onClick:()=>D("csv"),className:"font-body hover:scale-105 transform transition-all duration-200",children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),"Export CSV"]}),e.jsxs(w,{variant:"outline",size:"sm",onClick:()=>D("excel"),className:"font-body hover:scale-105 transform transition-all duration-200",children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Export Excel"]})]})]}),e.jsx(b,{value:"overview",className:"space-y-6",children:e.jsxs(r,{className:"luxury-card border-0",children:[e.jsxs(h,{children:[e.jsxs(g,{className:"font-heading velvet-text flex items-center gap-2",children:[e.jsx(Z,{className:"h-5 w-5"}),"Daily Sales Trend"]}),e.jsx(j,{className:"font-body",children:"Revenue and booking trends over the selected period"})]}),e.jsx(l,{children:e.jsx("div",{className:"h-64 flex items-center justify-center bg-gradient-to-br from-cream-100/50 to-cream-200/50 rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx(B,{className:"h-16 w-16 text-foreground/30 mx-auto mb-4 animate-float"}),e.jsx("p",{className:"text-foreground/70 font-body font-medium",children:"Sales Trend Visualization"}),e.jsxs("p",{className:"text-sm text-foreground/50 font-body",children:["Showing ",a?.salesReport.dailySales.length," days of sales data"]}),e.jsx(R,{className:"mt-2 bg-luxury-gold/20 text-luxury-gold border-luxury-gold",children:"Chart Ready for Integration"})]})})})]})}),e.jsx(b,{value:"countries",className:"space-y-6",children:e.jsxs(r,{className:"luxury-card border-0",children:[e.jsxs(h,{children:[e.jsxs(g,{className:"font-heading velvet-text flex items-center gap-2",children:[e.jsx(M,{className:"h-5 w-5"}),"Top Performing Countries"]}),e.jsx(j,{className:"font-body",children:"Countries ranked by booking volume and revenue"})]}),e.jsx(l,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(z,{children:[e.jsx(U,{children:e.jsxs(y,{children:[e.jsx(o,{className:"font-heading",children:"Country"}),e.jsx(o,{className:"font-heading",children:"Bookings"}),e.jsx(o,{className:"font-heading",children:"Revenue"}),e.jsx(o,{className:"font-heading",children:"Avg. Price"}),e.jsx(o,{className:"font-heading",children:"Market Share"})]})}),e.jsx(O,{children:a?.countryReport.topCountries.map((s,t)=>e.jsxs(y,{className:"hover:bg-gradient-to-r hover:from-cream-100/50 hover:to-transparent",children:[e.jsx(i,{className:"font-medium font-body",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold text-white ${t===0?"bg-gradient-to-br from-luxury-gold to-luxury-bronze":t===1?"bg-gradient-to-br from-gray-400 to-gray-500":t===2?"bg-gradient-to-br from-amber-600 to-amber-700":"bg-gradient-to-br from-blue-500 to-blue-600"}`,children:t+1}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:s.flag}),e.jsx("span",{children:s.country})]})]})}),e.jsx(i,{className:"font-body",children:s.bookings}),e.jsxs(i,{className:"font-body font-semibold text-green-600",children:["à§³",s.revenue.toLocaleString()]}),e.jsxs(i,{className:"font-body",children:["à§³",Math.round(s.revenue/s.bookings).toLocaleString()]}),e.jsx(i,{children:e.jsxs(R,{variant:"outline",className:"font-body",children:[(s.bookings/(a?.salesReport.totalBookings||1)*100).toFixed(1),"%"]})})]},s.country))})]})})})]})}),e.jsx(b,{value:"agents",className:"space-y-6",children:e.jsxs(r,{className:"luxury-card border-0",children:[e.jsxs(h,{children:[e.jsxs(g,{className:"font-heading velvet-text flex items-center gap-2",children:[e.jsx(E,{className:"h-5 w-5"}),"Top Performing Agents"]}),e.jsx(j,{className:"font-body",children:"Travel agents ranked by performance metrics"})]}),e.jsx(l,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(z,{children:[e.jsx(U,{children:e.jsxs(y,{children:[e.jsx(o,{className:"font-heading",children:"Agent"}),e.jsx(o,{className:"font-heading",children:"Bookings"}),e.jsx(o,{className:"font-heading",children:"Revenue"}),e.jsx(o,{className:"font-heading",children:"Avg. Deal Size"}),e.jsx(o,{className:"font-heading",children:"Performance"})]})}),e.jsx(O,{children:a?.agentReport.topAgents.map((s,t)=>e.jsxs(y,{className:"hover:bg-gradient-to-r hover:from-cream-100/50 hover:to-transparent",children:[e.jsx(i,{className:"font-medium font-body",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-100 to-blue-200 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-bold text-blue-600",children:t+1})}),s.agent]})}),e.jsx(i,{className:"font-body",children:s.bookings}),e.jsxs(i,{className:"font-body font-semibold text-green-600",children:["à§³",s.revenue.toLocaleString()]}),e.jsxs(i,{className:"font-body",children:["à§³",Math.round(s.revenue/s.bookings).toLocaleString()]}),e.jsx(i,{children:e.jsx(R,{className:`font-body ${t<2?"bg-green-100 text-green-800":t<4?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:t<2?"ðŸ† Excellent":t<4?"â­ Good":"ðŸ‘ Average"})})]},s.agent))})]})})})]})}),e.jsx(b,{value:"payments",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(r,{className:"luxury-card border-0",children:[e.jsxs(h,{children:[e.jsxs(g,{className:"font-heading velvet-text flex items-center gap-2",children:[e.jsx(ee,{className:"h-5 w-5"}),"Payment Methods"]}),e.jsx(j,{className:"font-body",children:"Distribution of payment methods used"})]}),e.jsx(l,{children:e.jsx("div",{className:"space-y-4",children:a?.paymentReport.paymentMethods.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-gradient-to-r from-cream-100/30 to-transparent hover:from-cream-100/50 transition-all duration-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-4 h-4 rounded ${t===0?"bg-green-500":t===1?"bg-blue-500":t===2?"bg-purple-500":"bg-orange-500"}`}),e.jsx("span",{className:"font-medium font-body",children:s.method})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold font-body",children:["à§³",s.amount.toLocaleString()]}),e.jsxs("p",{className:"text-sm text-foreground/60 font-body",children:[s.count," transactions"]})]})]},s.method))})})]}),e.jsxs(r,{className:"luxury-card border-0",children:[e.jsxs(h,{children:[e.jsxs(g,{className:"font-heading velvet-text flex items-center gap-2",children:[e.jsx(se,{className:"h-5 w-5"}),"Payment Status"]}),e.jsx(j,{className:"font-body",children:"Overview of payment completion status"})]}),e.jsx(l,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-gradient-to-r from-green-100/30 to-transparent",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-4 h-4 bg-green-500 rounded"}),e.jsx("span",{className:"font-medium font-body",children:"Completed Payments"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-semibold text-green-600 font-body",children:a?.paymentReport.completedPayments}),e.jsxs("p",{className:"text-sm text-foreground/60 font-body",children:[((a?.paymentReport.completedPayments||0)/((a?.paymentReport.completedPayments||0)+(a?.paymentReport.pendingPayments||0))*100).toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-gradient-to-r from-yellow-100/30 to-transparent",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-4 h-4 bg-yellow-500 rounded"}),e.jsx("span",{className:"font-medium font-body",children:"Pending Payments"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-semibold text-yellow-600 font-body",children:a?.paymentReport.pendingPayments}),e.jsxs("p",{className:"text-sm text-foreground/60 font-body",children:[((a?.paymentReport.pendingPayments||0)/((a?.paymentReport.completedPayments||0)+(a?.paymentReport.pendingPayments||0))*100).toFixed(1),"%"]})]})]}),e.jsx("div",{className:"pt-4 border-t border-border/30",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium font-body",children:"Total Transactions"}),e.jsx("span",{className:"font-bold font-heading velvet-text",children:(a?.paymentReport.completedPayments||0)+(a?.paymentReport.pendingPayments||0)})]})})]})})]})]})})]})})]}):e.jsx("div",{className:"space-y-6",children:e.jsx(d.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:e.jsx(r,{className:"luxury-card border-0",children:e.jsxs(l,{className:"p-12 text-center",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-red-100 to-red-200 rounded-full w-fit mx-auto mb-4",children:e.jsx(_,{className:"h-12 w-12 text-red-600"})}),e.jsx("h2",{className:"text-2xl font-heading font-bold velvet-text mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-foreground/70 font-body",children:"You don't have permission to view financial reports."})]})})})})}export{me as R};
